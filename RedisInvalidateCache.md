# Redis缓存失效备忘录

- ### 失效时间的控制

  - 调用PERSIST命令撤销一个主键的失效时间
  - 调用DEL命令删除主键同时撤销对应失效时间
  - 调用RENAME命令被覆盖的主键会撤销其失效时间

- ### 失效的内部实现

  - 消极方法
    - 在主键被访问时发现已经失效再删除主键释放内存
  - 积极方法
    - 根据定义的淘汰策略周期检查删除失效主键

- ### 数据淘汰的策略

  - volatile-lru:从设置了过期时间的数据集中，选择最近最久未使用的数据释放；

  - allkeys-lru:从数据集中(包括设置过期时间以及未设置过期时间的数据集中)，选择最近最久未使用的数据释放；

  - volatile-random:从设置了过期时间的数据集中，随机选择一个数据进行释放；

  - allkeys-random:从数据集中(包括了设置过期时间以及未设置过期时间)随机选择一个数据进行入释放；

  - volatile-ttl：从设置了过期时间的数据集中，选择马上就要过期的数据进行释放操作；

  - noeviction：不删除任意数据(但redis还会根据引用计数器进行释放),这时如果内存不够时，会直接返回错误。

    　默认的内存策略是noeviction，在Redis中LRU算法是一个近似算法，默认情况下，Redis随机挑选5个键，并且从中选取一个最近最久未使用的key进行淘汰，在配置文件中可以通过maxmemory-samples的值来设置redis需要检查key的个数

    

    